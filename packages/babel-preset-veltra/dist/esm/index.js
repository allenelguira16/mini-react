import u from"@babel/preset-react";import{declare as m}from"@babel/helper-plugin-utils";import*as e from"@babel/types";const g=m(p=>(p.assertVersion(7),{visitor:{Program(o,a){const i=a.filename||"";if(i.includes("/veltra-router/")||i.includes("\\veltra-router\\")||i.includes("/veltra-app/")||i.includes("\\veltra-app\\")||i.includes("/node_modules/@veltra/app/")||i.includes("\\node_modules\\@veltra\\app\\"))return;let t=!1;if(o.get("body").forEach(s=>{s.isImportDeclaration()&&s.node.source.value==="@veltra/app"&&s.node.specifiers.forEach(n=>{if(e.isImportSpecifier(n)){const r=n.imported;e.isIdentifier(r)&&r.name==="logJsx"&&(t=!0)}})}),!t){const s=e.importDeclaration([e.importSpecifier(e.identifier("logJsx"),e.identifier("logJsx"))],e.stringLiteral("@veltra/app"));o.unshiftContainer("body",s)}},CallExpression(o){const a=o.get("callee");if(e.isMemberExpression(a.node)&&e.isIdentifier(a.node.object,{name:"console"})&&e.isIdentifier(a.node.property)){const i=o.node.arguments.map(t=>e.isJSXElement(t)||e.isJSXFragment(t)?e.callExpression(e.identifier("logJsx"),[t]):t);i.some((t,s)=>t!==o.node.arguments[s])&&(o.node.arguments=i)}}}})),E=m(p=>(p.assertVersion(7),{pre(){const o=this.file.metadata;o.importedLoops=new Set,o.localLoops=new Set},visitor:{Program(o,a){const i=a.file.metadata,t=i.importedLoops,s=i.localLoops;o.get("body").forEach(n=>{n.isImportDeclaration()&&n.node.source.value==="@veltra/app"&&n.node.specifiers.forEach(r=>{e.isImportSpecifier(r)&&e.isIdentifier(r.imported,{name:"loop"})&&t.add(r.local.name)}),n.isFunctionDeclaration()&&e.isIdentifier(n.node.id)&&s.add(n.node.id.name),n.isVariableDeclaration()&&n.node.declarations.forEach(r=>{e.isIdentifier(r.id)&&s.add(r.id.name)})})},CallExpression(o,a){const i=a.file.metadata,t=i.importedLoops,s=i.localLoops,n=o.get("callee");if(!n.isIdentifier())return;const r=n.node.name;if(t.has(r)&&!s.has(r)&&o.node.arguments.length===1){const l=o.node.arguments[0];!e.isArrowFunctionExpression(l)&&e.isExpression(l)&&(o.node.arguments[0]=e.arrowFunctionExpression([],l))}}}}));m(p=>(p.assertVersion(7),{visitor:{Program(o,a){const i=a.filename||"";if(i.includes("/veltra-router/")||i.includes("\\veltra-router\\")||i.includes("/veltra-app/")||i.includes("\\veltra-app\\")||i.includes("/node_modules/@veltra/app/")||i.includes("\\node_modules\\@veltra\\app\\"))return;let t=!1;o.get("body").forEach(n=>{n.isImportDeclaration()&&n.node.source.value==="@veltra/app"&&n.node.specifiers.forEach(r=>{if(e.isImportSpecifier(r)){const l=r.imported;e.isIdentifier(l)&&l.name==="loop"&&(t=!0)}})});const s=[];if(t||s.push(e.importSpecifier(e.identifier("loop"),e.identifier("loop"))),s.length){const n=e.importDeclaration(s,e.stringLiteral("@veltra/app"));o.unshiftContainer("body",n)}},JSXExpressionContainer(o){const a=o.get("expression");function i(s){const n=s.node;if(e.isCallExpression(n)&&e.isMemberExpression(n.callee)&&e.isIdentifier(n.callee.property)&&n.callee.property.name==="map"){const r=n.arguments[0],l=n.callee.object;if(e.isArrowFunctionExpression(r)&&r.params.length>=2){const c=r.params[1];e.isIdentifier(c)&&e.traverseFast(r.body,d=>{if(e.isIdentifier(d)&&d.name===c.name){const f=e.memberExpression(e.identifier(c.name),e.identifier("value"));Object.assign(d,f)}})}return e.callExpression(e.memberExpression(e.callExpression(e.identifier("loop"),[e.arrowFunctionExpression([],l)]),e.identifier("each")),[r])}return null}function t(s){const n=s.node;if(e.isLogicalExpression(n)){const r=s.get("right"),l=i(r);l&&r.replaceWith(l)}else if(e.isConditionalExpression(n)){const r=s.get("consequent"),l=s.get("alternate"),c=i(r),d=i(l);c&&r.replaceWith(c),d&&l.replaceWith(d)}else{const r=i(s);r&&s.replaceWith(r)}}t(a)}}}));const x=m(p=>(p.assertVersion(7),{visitor:{Program(o){const a=new Set(["Suspense"]);o.traverse({ImportDeclaration(i){i.node.source.value==="@veltra/app"&&i.node.specifiers.forEach(t=>{e.isImportSpecifier(t)&&e.isIdentifier(t.imported)&&t.imported.name==="Suspense"&&a.add(t.local.name)})}}),o.traverse({JSXElement(i){const t=i.node.openingElement;if(e.isJSXIdentifier(t.name)&&a.has(t.name.name)){const s=i.node.children;if(s.length===0||e.isJSXExpressionContainer(s[0]))return;const n=e.jSXExpressionContainer(e.jSXFragment(e.jSXOpeningFragment(),e.jSXClosingFragment(),s));i.node.children=[n]}}})}}})),v=m(p=>(p.assertVersion(7),{visitor:{JSXExpressionContainer(o){const a=o.get("expression");e.isJSXEmptyExpression(a.node)||(o.node.expression=e.arrowFunctionExpression([],a.node))}}}));function h(p){return p.assertVersion(7),{presets:[[u,{runtime:"automatic",importSource:"@veltra/app"}]],plugins:[g,E,x,v]}}export{h as default};
//# sourceMappingURL=index.js.map
