"use strict";var u=require("~/util"),l=require("~/life-cycle"),d=require("~/reactivity"),h=require("~/const"),R=require("~/jsx-runtime"),S=require("~/context");require("~/render");var y=require("@veltra/app");const $=typeof document>"u";function m(t,e,n,o){const r=Math.max(e.length,n.length);for(let i=0;i<r;i++){const s=e[i],c=n[i];if(o){if(u.isNil(c))continue;t.appendChild(c),e[i]=c;continue}if(u.isNil(s)&&!u.isNil(c)){t.appendChild(c),e[i]=c;continue}if(!u.isNil(s)&&u.isNil(c)){l.runComponentCleanup(s),t.removeChild(e[i]),e.splice(i,1),i--;continue}if(!(u.isNil(s)&&u.isNil(c))){if(s&&c){s.isSameNode(c)||(l.runComponentCleanup(s),s.replaceWith(c),e[i]=c);continue}console.warn("[veltra]: warning - unknown dom detected: ",{old:s,new:c})}}return[...e]}function b(t){let e=null;const n=()=>{e&&e(),e=d.effect(()=>{try{t()}catch(o){o instanceof Promise?o.then(n).catch(console.error):console.error(o)}})};n()}function P(t,e,n){for(const o of e)if(typeof o=="function"){let r=[],i=!0;b(()=>{const s=u.toArray(o()).map(u.getNode).flat();r=m(t,r,s,i),i=!1})}else{const r=u.getNode(o);!Array.isArray(r)&&r&&t.appendChild(r)}}function A({children:t}){return t}function N(t){const e=()=>{w(e),S.effectContext&&S.effectContext.push(e);try{t()}finally{}};return e.deps=[],e(),()=>w(e)}function w(t){if(t.deps){for(const e of t.deps)e.delete(t);t.deps.length=0}}function T(t,e){for(const n in e)if(n.startsWith("on")&&typeof e[n]=="function"){const o=n.slice(2).toLowerCase();let r;N(()=>{r&&r();const i=e[n]();typeof i=="function"&&(t.addEventListener(o,i),r=()=>t.removeEventListener(o,i))})}else N(()=>{const o=typeof e[n]=="function"?e[n]():e[n];n==="ref"&&typeof o=="function"?o(t):n==="style"?_(t,o):n==="disabled"?t.toggleAttribute(n,o):t.setAttribute(n,o)})}function _(t,e){if(t instanceof HTMLElement)for(const[n,o]of Object.entries(e)){const r=n;if(r==="length"||r==="parentRule")continue;const i=typeof o=="number"&&!M(n)?`${o}px`:String(o);t.style.setProperty(String(r),i)}}function M(t){return new Set(h.UNIT_LESS_PROPS).has(t)}const v=d.state(null);function j(t){const e=document.createTextNode("");let n;const{fallback:o,children:[r]}=t,i=o();let s=!0,c=[];const L=()=>{c=m(n,c,C(i),s),s=!1},g=()=>{const f=C(r()).flat();c=m(n,c,f,s)};return queueMicrotask(()=>{n=e.parentNode,d.effect(()=>{try{if(!n)return;if(L(),v.value)throw v.value;g()}catch(f){if(f instanceof Promise)f.then(()=>{v.value=null,g()}).catch(()=>{});else throw f}})}),e}const C=t=>{const e=[],n=u.toArray(t);for(const o of n){const r=u.getNode(o);Array.isArray(r)?e.push(...r):e.push(r)}return e},k=[j];function F(t,e){if(!k.includes(t))for(const n in e)e[n]=e[n]instanceof Function?e[n]():e[n]}const z=new Set;function G(t,e,n){F(t,e);const o={mount:[],effect:[],destroy:[]};l.initializeLifecycleContext(o);const r=d.untrack(()=>t({...e,children:n}));let i=r;return Array.isArray(r)&&(i=document.createTextNode(""),r.unshift(i)),l.registerLifeCycles(o,i),z.add(i),r}function W(t,e,n){if(t===R.Fragment)return n;if(typeof t=="function")return G(t,e,n);const o=H(t,e.xmlns);return T(o,e),P(o,n),o}function H(t,e){return(h.SVG_TAGS.has(t)||h.MATH_ML_TAGS.has(t))&&e?document.createElementNS(e,t):document.createElement(t)}function I(t,e,n){return typeof t=="function"?t({...e,children:n}):`<${t} ${O(e)}>${x(n)}</${t}>`}function O(t){const e=[];for(const n in t){if(n.startsWith("on")&&typeof t[n]=="function")continue;const o=typeof t[n]=="function"?t[n]():t[n];n==="ref"&&typeof o=="function"||n==="style"||(n==="disabled"&&o?e.push("disabled"):e.push(`${n}="${o}"`))}return e.join(" ")}function x(t){const e=[];for(const n of t)typeof n=="function"?e.push(String(n())):Array.isArray(n)?n.forEach(o=>e.push(x([o]))):e.push(n);return e.join("")}const q=t=>(Array.isArray(t)?t:[t]).flat(1/0),p=(t,{children:e=[],...n})=>$?I(t,n,q(e)):W(t,n,q(e)),a=y.state({pathname:window.location.pathname,search:window.location.search});window.addEventListener("popstate",()=>{a.value={...a.value,pathname:window.location.pathname}});function D(t){history.pushState(null,"",t),a.value={...a.value,pathname:t}}function E(t,e){for(const n of e){if(n.path===t)return n;if(n.children){const o=E(t,n.children);if(o)return o}}}function U(t){const e=y.state(()=>p(A,{}));return y.effect(()=>{const n=E(a.value.pathname,t.routes);if(n){if(n.guard&&!n.guard()){e.value=()=>p("div",{children:"Access Denied"});return}if(n.lazy){n.lazy().then(o=>{e.value=o.default});return}e.value=n.component}else e.value=()=>p("div",{children:"404 Not Found"})}),()=>p(A,{children:e.value()})}exports.Router=U,exports.location=a,exports.navigate=D;
//# sourceMappingURL=index.js.map
