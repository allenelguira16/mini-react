"use strict";var u=require("~/util"),f=require("~/life-cycle"),N=require("~/reactivity"),v=require("~/const"),T=require("~/jsx-runtime"),C=require("~/context");require("~/render");var g=require("@veltra/app");const k=typeof document>"u";function E(e,n,t,o){const r=Math.max(n.length,t.length);for(let i=0;i<r;i++){const c=n[i],s=t[i];if(u.isNil(c)&&!u.isNil(s)){o?e.insertBefore(s,o):e.appendChild(s),f.runLifecycle(s),n[i]=s;continue}if(!u.isNil(c)&&u.isNil(s)){f.runComponentCleanup(c),e.removeChild(c),n[i]=void 0;continue}if(!(u.isNil(c)&&u.isNil(s))){if(c&&s){f.runComponentCleanup(c),f.runLifecycle(s),c.replaceWith(s),n[i]=s;continue}console.warn("[veltra]: warning - unknown dom detected: ",{old:c,new:s})}}return[...n]}const P=[F];function _(e,n){if(!P.includes(e))for(const t in n)n[t]=n[t]instanceof Function?n[t]():n[t]}const L=new Set;function j(e,{key:n,...t},o){const r=n?.();_(e,t);const i=f.createLifeCycleContext(e,r),c=document.createTextNode("");L.add(c);const s=u.toArray(N.untrack(()=>e({...t,children:o})));return f.componentLifecycleContexts.set(c,i),s.unshift(c),s}const h=[];function F(e){const n=document.createTextNode("");L.add(n);const{fallback:t,children:[o]}=e;return f.onMount(()=>{const r=n.parentNode;if(!r)return;const i=[],c=a=>{h.push(s),i.push(A(r,[a],n)),h.pop()},s=a=>{queueMicrotask(()=>{i.forEach(l=>l()),t&&c(t)}),a.then(()=>{i.forEach(l=>l()),c(o)})};c(o)}),n}function W(){return h[h.length-1]}function A(e,n,t){const o={disposer:[],oldNodes:[]};for(const r of n){const i=document.createTextNode("");e.insertBefore(i,t??null);let c=[];const s=W(),a=()=>{const l=N.effect(()=>{let S,w=[];try{S=typeof r=="function"?r():r,w=u.toArray(u.getNode(S))}catch(p){if(p instanceof Promise)s?s(p):p.then(()=>{l(),a()});else throw p}c=E(e,c,w,i),o.oldNodes.push(()=>{E(e,c,[],t)})});o.disposer.push(()=>{l()})};a()}return()=>{o.disposer.forEach(r=>r()),o.oldNodes.forEach(r=>r())}}function x({children:e}){return e}function q(e){const n=()=>{$(n),C.effectContext&&C.effectContext.push(n);try{e()}finally{}};return n.deps=[],n(),()=>$(n)}function $(e){if(e.deps){for(const n of e.deps)n.delete(e);e.deps.length=0}}const y=new WeakMap;function z(e,n,t){let o=y.get(e);o||(o=new Map,y.set(e,o)),o.has(n)&&e.removeEventListener(n,o.get(n)),e.addEventListener(n,t),o.set(n,t)}function G(e,n){const t=y.get(e);if(!t)return;const o=t.get(n);o&&(e.removeEventListener(n,o),t.delete(n)),t.size===0&&y.delete(e)}function H(e,n){for(const t in n)if(t.startsWith("on")&&typeof n[t]=="function"){const o=t.slice(2).toLowerCase();let r;q(()=>{r&&r();const i=n[t]();typeof i=="function"&&(z(e,o,i),r=()=>G(e,o))})}else{const o=()=>{const r=typeof n[t]=="function"?n[t]():n[t];t==="ref"&&typeof r=="function"?r(e):t==="style"?B(e,r):t==="disabled"?e.toggleAttribute(t,r):e.setAttribute(t,r)};q(()=>{try{o()}catch(r){if(r instanceof Promise)r.then(o);else throw r}})}}function B(e,n){if(e instanceof HTMLElement)for(const[t,o]of Object.entries(n)){const r=t;if(r==="length"||r==="parentRule")continue;const i=typeof o=="number"&&!I(t)?`${o}px`:String(o);e.style.setProperty(String(r),i)}}function I(e){return new Set(v.UNIT_LESS_PROPS).has(e)}function O(e,n,t,o){if(e===T.Fragment)return t;if(typeof e=="function")return j(e,{key:o,...n},t);const r=D(e,n.xmlns);return H(r,n),A(r,t),r}function D(e,n){return(v.SVG_TAGS.has(e)||v.MATH_ML_TAGS.has(e))&&n?document.createElementNS(n,e):document.createElement(e)}function U(e,n,t){return typeof e=="function"?e({...n,children:t}):`<${e} ${V(n)}>${b(t)}</${e}>`}function V(e){const n=[];for(const t in e){if(t.startsWith("on")&&typeof e[t]=="function")continue;const o=typeof e[t]=="function"?e[t]():e[t];t==="ref"&&typeof o=="function"||t==="style"||(t==="disabled"&&o?n.push("disabled"):n.push(`${t}="${o}"`))}return n.join(" ")}function b(e){const n=[];for(const t of e)typeof t=="function"?n.push(String(t())):Array.isArray(t)?t.forEach(o=>n.push(b([o]))):n.push(t);return n.join("")}const M=e=>(Array.isArray(e)?e:[e]).flat(1/0),m=(e,{children:n=[],...t},o)=>k?U(e,t,M(n)):O(e,t,M(n),o),d=g.state({pathname:window.location.pathname,search:window.location.search});window.addEventListener("popstate",()=>{d.value={...d.value,pathname:window.location.pathname}});function J(e){history.pushState(null,"",e),d.value={...d.value,pathname:e}}function R(e,n){for(const t of n){if(t.path===e)return t;if(t.children){const o=R(e,t.children);if(o)return o}}}function K(e){const n=g.state(()=>m(x,{}));return g.effect(()=>{const t=R(d.value.pathname,e.routes);if(t){if(t.guard&&!t.guard()){n.value=()=>m("div",{children:"Access Denied"});return}if(t.lazy){t.lazy().then(o=>{n.value=o.default});return}n.value=t.component}else n.value=()=>m("div",{children:"404 Not Found"})}),()=>m(x,{children:n.value()})}exports.Router=K,exports.location=d,exports.navigate=J;
//# sourceMappingURL=index.js.map
