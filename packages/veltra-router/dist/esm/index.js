import{isNil as f,getNode as p,toArray as y}from"~/util";import{runComponentCleanup as v,initializeLifecycleContext as P,registerLifeCycles as R}from"~/life-cycle";import{effect as S,state as T,untrack as _}from"~/reactivity";import{UNIT_LESS_PROPS as F,SVG_TAGS as M,MATH_ML_TAGS as k}from"~/const";import{Fragment as j}from"~/jsx-runtime";import{effectContext as A}from"~/context";import"~/render";import{state as g,effect as z}from"@veltra/app";const G=typeof document>"u";function d(t,e,n,o){const r=Math.max(e.length,n.length);for(let i=0;i<r;i++){const s=e[i],c=n[i];if(o){if(f(c))continue;t.appendChild(c),e[i]=c;continue}if(f(s)&&!f(c)){t.appendChild(c),e[i]=c;continue}if(!f(s)&&f(c)){v(s),t.removeChild(e[i]),e.splice(i,1),i--;continue}if(!(f(s)&&f(c))){if(s&&c){s.isSameNode(c)||(v(s),s.replaceWith(c),e[i]=c);continue}console.warn("[veltra]: warning - unknown dom detected: ",{old:s,new:c})}}return[...e]}function W(t){let e=null;const n=()=>{e&&e(),e=S(()=>{try{t()}catch(o){o instanceof Promise?o.then(n).catch(console.error):console.error(o)}})};n()}function H(t,e,n){for(const o of e)if(typeof o=="function"){let r=[],i=!0;W(()=>{const s=y(o()).map(p).flat();r=d(t,r,s,i),i=!1})}else{const r=p(o);!Array.isArray(r)&&r&&t.appendChild(r)}}function w({children:t}){return t}function $(t){const e=()=>{C(e),A&&A.push(e);try{t()}finally{}};return e.deps=[],e(),()=>C(e)}function C(t){if(t.deps){for(const e of t.deps)e.delete(t);t.deps.length=0}}function I(t,e){for(const n in e)if(n.startsWith("on")&&typeof e[n]=="function"){const o=n.slice(2).toLowerCase();let r;$(()=>{r&&r();const i=e[n]();typeof i=="function"&&(t.addEventListener(o,i),r=()=>t.removeEventListener(o,i))})}else $(()=>{const o=typeof e[n]=="function"?e[n]():e[n];n==="ref"&&typeof o=="function"?o(t):n==="style"?O(t,o):n==="disabled"?t.toggleAttribute(n,o):t.setAttribute(n,o)})}function O(t,e){if(t instanceof HTMLElement)for(const[n,o]of Object.entries(e)){const r=n;if(r==="length"||r==="parentRule")continue;const i=typeof o=="number"&&!q(n)?`${o}px`:String(o);t.style.setProperty(String(r),i)}}function q(t){return new Set(F).has(t)}const h=T(null);function D(t){const e=document.createTextNode("");let n;const{fallback:o,children:[r]}=t,i=o();let s=!0,c=[];const x=()=>{c=d(n,c,N(i),s),s=!1},m=()=>{const a=N(r()).flat();c=d(n,c,a,s)};return queueMicrotask(()=>{n=e.parentNode,S(()=>{try{if(!n)return;if(x(),h.value)throw h.value;m()}catch(a){if(a instanceof Promise)a.then(()=>{h.value=null,m()}).catch(()=>{});else throw a}})}),e}const N=t=>{const e=[],n=y(t);for(const o of n){const r=p(o);Array.isArray(r)?e.push(...r):e.push(r)}return e},U=[D];function V(t,e){if(!U.includes(t))for(const n in e)e[n]=e[n]instanceof Function?e[n]():e[n]}const B=new Set;function J(t,e,n){V(t,e);const o={mount:[],effect:[],destroy:[]};P(o);const r=_(()=>t({...e,children:n}));let i=r;return Array.isArray(r)&&(i=document.createTextNode(""),r.unshift(i)),R(o,i),B.add(i),r}function K(t,e,n){if(t===j)return n;if(typeof t=="function")return J(t,e,n);const o=Q(t,e.xmlns);return I(o,e),H(o,n),o}function Q(t,e){return(M.has(t)||k.has(t))&&e?document.createElementNS(e,t):document.createElement(t)}function X(t,e,n){return typeof t=="function"?t({...e,children:n}):`<${t} ${Y(e)}>${E(n)}</${t}>`}function Y(t){const e=[];for(const n in t){if(n.startsWith("on")&&typeof t[n]=="function")continue;const o=typeof t[n]=="function"?t[n]():t[n];n==="ref"&&typeof o=="function"||n==="style"||(n==="disabled"&&o?e.push("disabled"):e.push(`${n}="${o}"`))}return e.join(" ")}function E(t){const e=[];for(const n of t)typeof n=="function"?e.push(String(n())):Array.isArray(n)?n.forEach(o=>e.push(E([o]))):e.push(n);return e.join("")}const L=t=>(Array.isArray(t)?t:[t]).flat(1/0),l=(t,{children:e=[],...n})=>G?X(t,n,L(e)):K(t,n,L(e)),u=g({pathname:window.location.pathname,search:window.location.search});window.addEventListener("popstate",()=>{u.value={...u.value,pathname:window.location.pathname}});function Z(t){history.pushState(null,"",t),u.value={...u.value,pathname:t}}function b(t,e){for(const n of e){if(n.path===t)return n;if(n.children){const o=b(t,n.children);if(o)return o}}}function ee(t){const e=g(()=>l(w,{}));return z(()=>{const n=b(u.value.pathname,t.routes);if(n){if(n.guard&&!n.guard()){e.value=()=>l("div",{children:"Access Denied"});return}if(n.lazy){n.lazy().then(o=>{e.value=o.default});return}e.value=n.component}else e.value=()=>l("div",{children:"404 Not Found"})}),()=>l(w,{children:e.value()})}export{ee as Router,u as location,Z as navigate};
//# sourceMappingURL=index.js.map
