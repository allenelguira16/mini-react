import{isNil as u,toArray as v,getNode as b}from"~/util";import{runComponentCleanup as g,createLifeCycleContext as k,runLifecycle as T,onMount as P}from"~/life-cycle";import{untrack as R,effect as _}from"~/reactivity";import{UNIT_LESS_PROPS as F,SVG_TAGS as W,MATH_ML_TAGS as j}from"~/const";import{Fragment as z}from"~/jsx-runtime";import{effectContext as S}from"~/context";import"~/render";import{state as w,effect as G}from"@veltra/app";const H=typeof document>"u";function E(e,n,t,o){const r=Math.max(n.length,t.length);for(let i=0;i<r;i++){const c=n[i],s=t[i];if(u(c)&&!u(s)){o?e.insertBefore(s,o):e.appendChild(s),n[i]=s;continue}if(!u(c)&&u(s)){g(c),e.removeChild(c),n[i]=void 0;continue}if(!(u(c)&&u(s))){if(c&&s){g(c),c.replaceWith(s),n[i]=s;continue}console.warn("[veltra]: warning - unknown dom detected: ",{old:c,new:s})}}return[...n]}const q=[B];function I(e,n){if(!q.includes(e))for(const t in n)n[t]=n[t]instanceof Function?n[t]():n[t]}const $=new Set;function O(e,{key:n,...t},o){const r=n?.();I(e,t);const i=k(e,r),c=document.createTextNode(""),s=v(R(()=>e({...t,children:o})));return T(i,c),s.unshift(c),$.add(c),s}const a=[];function B(e){const n=document.createTextNode("");$.add(n);const{fallback:t,children:[o]}=e;return P(()=>{const r=n.parentNode;if(!r)return;const i=[],c=s=>{queueMicrotask(()=>{i.forEach(f=>f()),t&&i.push(p(r,[t],n))}),s.then(()=>{i.forEach(f=>f()),a.push(c),i.push(p(r,[o],n)),a.pop()})};a.push(c),i.push(p(r,[o],n)),a.pop()}),n}function D(){return a[a.length-1]}function p(e,n,t=document.createTextNode("")){e.contains(t)||e.appendChild(t);const o=[];for(const r of n){let i=[];const c=D(),s=_(()=>{let f,y=[];try{f=typeof r=="function"?r():r,y=v(b(f))}catch(m){if(m instanceof Promise)c&&(queueMicrotask(()=>{s()}),c(m));else throw m}finally{i=E(e,i,y,t),o.push(()=>{E(e,i,[],t)})}});o.push(()=>{s()})}return()=>{o.forEach(r=>r())}}function A({children:e}){return e}function C(e){const n=()=>{L(n),S&&S.push(n);try{e()}finally{}};return n.deps=[],n(),()=>L(n)}function L(e){if(e.deps){for(const n of e.deps)n.delete(e);e.deps.length=0}}const d=new WeakMap;function U(e,n,t){let o=d.get(e);o||(o=new Map,d.set(e,o)),o.has(n)&&e.removeEventListener(n,o.get(n)),e.addEventListener(n,t),o.set(n,t)}function V(e,n){const t=d.get(e);if(!t)return;const o=t.get(n);o&&(e.removeEventListener(n,o),t.delete(n)),t.size===0&&d.delete(e)}function J(e,n){for(const t in n)if(t.startsWith("on")&&typeof n[t]=="function"){const o=t.slice(2).toLowerCase();let r;C(()=>{r&&r();const i=n[t]();typeof i=="function"&&(U(e,o,i),r=()=>V(e,o))})}else{const o=()=>{const r=typeof n[t]=="function"?n[t]():n[t];t==="ref"&&typeof r=="function"?r(e):t==="style"?K(e,r):t==="disabled"?e.toggleAttribute(t,r):e.setAttribute(t,r)};C(()=>{try{o()}catch(r){if(r instanceof Promise)r.then(o);else throw r}})}}function K(e,n){if(e instanceof HTMLElement)for(const[t,o]of Object.entries(n)){const r=t;if(r==="length"||r==="parentRule")continue;const i=typeof o=="number"&&!Q(t)?`${o}px`:String(o);e.style.setProperty(String(r),i)}}function Q(e){return new Set(F).has(e)}function X(e,n,t,o){if(e===z)return t;if(typeof e=="function")return O(e,{key:o,...n},t);const r=Y(e,n.xmlns);return J(r,n),p(r,t),r}function Y(e,n){return(W.has(e)||j.has(e))&&n?document.createElementNS(n,e):document.createElement(e)}function Z(e,n,t){return typeof e=="function"?e({...n,children:t}):`<${e} ${ee(n)}>${N(t)}</${e}>`}function ee(e){const n=[];for(const t in e){if(t.startsWith("on")&&typeof e[t]=="function")continue;const o=typeof e[t]=="function"?e[t]():e[t];t==="ref"&&typeof o=="function"||t==="style"||(t==="disabled"&&o?n.push("disabled"):n.push(`${t}="${o}"`))}return n.join(" ")}function N(e){const n=[];for(const t of e)typeof t=="function"?n.push(String(t())):Array.isArray(t)?t.forEach(o=>n.push(N([o]))):n.push(t);return n.join("")}const x=e=>(Array.isArray(e)?e:[e]).flat(1/0),h=(e,{children:n=[],...t},o)=>H?Z(e,t,x(n)):X(e,t,x(n),o),l=w({pathname:window.location.pathname,search:window.location.search});window.addEventListener("popstate",()=>{l.value={...l.value,pathname:window.location.pathname}});function te(e){history.pushState(null,"",e),l.value={...l.value,pathname:e}}function M(e,n){for(const t of n){if(t.path===e)return t;if(t.children){const o=M(e,t.children);if(o)return o}}}function ne(e){const n=w(()=>h(A,{}));return G(()=>{const t=M(l.value.pathname,e.routes);if(t){if(t.guard&&!t.guard()){n.value=()=>h("div",{children:"Access Denied"});return}if(t.lazy){t.lazy().then(o=>{n.value=o.default});return}n.value=t.component}else n.value=()=>h("div",{children:"404 Not Found"})}),()=>h(A,{children:n.value()})}export{ne as Router,l as location,te as navigate};
//# sourceMappingURL=index.js.map
