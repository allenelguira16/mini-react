import{isNil as a,toArray as v,getNode as k}from"~/util";import{runLifecycle as g,runComponentCleanup as S,createLifeCycleContext as P,componentLifecycleContexts as R,onMount as _}from"~/life-cycle";import{untrack as F,effect as W}from"~/reactivity";import{UNIT_LESS_PROPS as j,SVG_TAGS as z,MATH_ML_TAGS as G}from"~/const";import{Fragment as H}from"~/jsx-runtime";import{effectContext as w}from"~/context";import"~/render";import{state as E,effect as B}from"@veltra/app";const I=typeof document>"u";function A(e,n,t,o){const r=Math.max(n.length,t.length);for(let c=0;c<r;c++){const i=n[c],s=t[c];if(a(i)&&!a(s)){o?e.insertBefore(s,o):e.appendChild(s),g(s),n[c]=s;continue}if(!a(i)&&a(s)){S(i),e.removeChild(i),n[c]=void 0;continue}if(!(a(i)&&a(s))){if(i&&s){S(i),g(s),i.replaceWith(s),n[c]=s;continue}console.warn("[veltra]: warning - unknown dom detected: ",{old:i,new:s})}}return[...n]}const O=[U];function q(e,n){if(!O.includes(e))for(const t in n)n[t]=n[t]instanceof Function?n[t]():n[t]}const C=new Set;function D(e,{key:n,...t},o){const r=n?.();q(e,t);const c=P(e,r),i=document.createTextNode("");C.add(i);const s=v(F(()=>e({...t,children:o})));return R.set(i,c),s.unshift(i),s}const p=[];function U(e){const n=document.createTextNode("");C.add(n);const{fallback:t,children:[o]}=e;return _(()=>{const r=n.parentNode;if(!r)return;const c=[],i=f=>{p.push(s),c.push(L(r,[f],n)),p.pop()},s=f=>{queueMicrotask(()=>{c.forEach(u=>u()),t&&i(t)}),f.then(()=>{c.forEach(u=>u()),i(o)})};i(o)}),n}function V(){return p[p.length-1]}function L(e,n,t){const o={disposer:[],oldNodes:[]};for(const r of n){const c=document.createTextNode("");e.insertBefore(c,t??null);let i=[];const s=V(),f=()=>{const u=W(()=>{let y=[];try{y=v(k(r))}catch(d){if(d instanceof Promise)s?s(d):d.then(()=>{u(),f()});else throw d}i=A(e,i,y,c),o.oldNodes.push(()=>{A(e,i,[],t)})});o.disposer.push(()=>{u()})};f()}return()=>{o.disposer.forEach(r=>r()),o.oldNodes.forEach(r=>r())}}function N({children:e}){return e}function $(e){const n=()=>{x(n),w&&w.push(n);try{e()}finally{}},t=()=>x(n);return n.deps=[],n(),t}function x(e){if(e.deps){for(const n of e.deps)n.delete(e);e.deps.length=0}}const h=new WeakMap;function J(e,n,t){let o=h.get(e);o||(o=new Map,h.set(e,o)),o.has(n)&&e.removeEventListener(n,o.get(n)),e.addEventListener(n,t),o.set(n,t)}function K(e,n){const t=h.get(e);if(!t)return;const o=t.get(n);o&&(e.removeEventListener(n,o),t.delete(n)),t.size===0&&h.delete(e)}function Q(e,n){for(const t in n)if(t.startsWith("on")&&typeof n[t]=="function"){const o=t.slice(2).toLowerCase();let r;$(()=>{r&&r();const c=n[t]();typeof c=="function"&&(J(e,o,c),r=()=>K(e,o))})}else{const o=()=>{const r=typeof n[t]=="function"?n[t]():n[t];t==="ref"&&typeof r=="function"?r(e):t==="style"?X(e,r):t==="disabled"?e.toggleAttribute(t,r):e.setAttribute(t,r)};$(()=>{try{o()}catch(r){if(r instanceof Promise)r.then(o);else throw r}})}}function X(e,n){if(e instanceof HTMLElement)for(const[t,o]of Object.entries(n)){const r=t;if(r==="length"||r==="parentRule")continue;const c=typeof o=="number"&&!Y(t)?`${o}px`:String(o);e.style.setProperty(String(r),c)}}function Y(e){return new Set(j).has(e)}function Z(e,n,t,o){if(e===H)return t;if(typeof e=="function")return D(e,{key:o,...n},t);const r=ee(e,n.xmlns);return Q(r,n),L(r,t),r}function ee(e,n){return(z.has(e)||G.has(e))&&n?document.createElementNS(n,e):document.createElement(e)}function te(e,n,t){return typeof e=="function"?e({...n,children:t}):`<${e} ${ne(n)}>${b(t)}</${e}>`}function ne(e){const n=[];for(const t in e){if(t.startsWith("on")&&typeof e[t]=="function")continue;const o=typeof e[t]=="function"?e[t]():e[t];t==="ref"&&typeof o=="function"||t==="style"||(t==="disabled"&&o?n.push("disabled"):n.push(`${t}="${o}"`))}return n.join(" ")}function b(e){const n=[];for(const t of e)typeof t=="function"?n.push(String(t())):Array.isArray(t)?t.forEach(o=>n.push(b([o]))):n.push(t);return n.join("")}const M=e=>(Array.isArray(e)?e:[e]).flat(1/0),m=(e,{children:n=[],...t},o)=>I?te(e,t,M(n)):Z(e,t,M(n),o),l=E({pathname:window.location.pathname,search:window.location.search});window.addEventListener("popstate",()=>{l.value={...l.value,pathname:window.location.pathname}});function oe(e){history.pushState(null,"",e),l.value={...l.value,pathname:e}}function T(e,n){for(const t of n){if(t.path===e)return t;if(t.children){const o=T(e,t.children);if(o)return o}}}function re(e){const n=E(()=>m(N,{}));return B(()=>{const t=T(l.value.pathname,e.routes);if(t){if(t.guard&&!t.guard()){n.value=()=>m("div",{children:"Access Denied"});return}if(t.lazy){t.lazy().then(o=>{n.value=o.default});return}n.value=t.component}else n.value=()=>m("div",{children:"404 Not Found"})}),()=>m(N,{children:n.value()})}export{re as Router,l as location,oe as navigate};
//# sourceMappingURL=index.js.map
